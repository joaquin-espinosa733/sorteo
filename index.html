<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sorteo Aleatorio</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #fa8412;
        color: #ffffff;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 30px;
        font-family: 'Montserrat', sans-serif;
      }

      h1 {
        color: #08468e;
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
      }

      input[type="number"],
      input[type="file"],
      button {
        margin: 10px;
        padding: 10px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
      }

      input[type="number"],
      input[type="file"] {
        background-color: white;
        color: #08468e;
      }

      button {
        background-color: white;
        color: #08468e;
        cursor: pointer;
        transition: background-color 0.2s ease;
        font-weight: 600;
      }

      button:hover:enabled {
        background-color: #08468e;
        color: white;
      }

      button:disabled {
        background-color: #444;
        color: #08468e;
        cursor: not-allowed;
      }

      #ganadores {
        margin-top: 30px;
        background-color: white;
        padding: 20px;
        border-radius: 10px;
        width: 80%;
        max-width: 600px;
        text-align: center;
      }

      #ganadores h3 {
        margin-bottom: 15px;
        color: #08468e;
      }

      /* ðŸŽ‰ Estilo de la lista de ganadores */
      #ganadores ul {
        list-style: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
        flex-direction: column;
      }

      /* Cuando haya mÃ¡s de 10 ganadores, usamos grid de 2 columnas */
      #ganadores ul.dos-columnas {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      #ganadores li {
        background: #08468e;
        color: #fa8412;
        font-weight: bold;
        font-size: 18px;
        padding: 12px 20px;
        border-radius: 10px;
        /* box-shadow: 0 0 15px white; */
        animation: fadeIn 0.6s ease forwards;
        opacity: 0;
      }

      @keyframes fadeIn {
        from {
          transform: translateY(20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      #contador {
        margin-top: 10px;
        font-size: 16px;
        color: white;
      }

      /* ðŸŽ¯ Contador estilo sorteo */
      #cuenta-regresiva {
        font-size: 120px; /* mÃ¡s grande sin tocar el layout */
        font-weight: bold;
        color: #08468e;
        /* text-shadow: 0 0 25px #2989f7; */
        animation: pop 1s infinite;
      }

      @keyframes pop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <h1>Sorteo Fiesta DÃ­a del Maestro SUTE ðŸŽ‰</h1>

    <input type="file" id="archivo" accept=".txt" />
    <br />
    <label for="cantidad">Cantidad de ganadores a sortear:</label>
    <input type="number" id="cantidad" min="1" value="1" />
    <br />
    <button id="botonSortear" onclick="sortear()">Sortear</button>
    <button onclick="reiniciar()">Reiniciar ganadores</button>

    <div id="contador">Ganadores hasta ahora: 0</div>
    <div id="cuenta-regresiva"></div>
    <div id="ganadores"></div>

    <script>
      let lista = [];
      let ganadores = JSON.parse(localStorage.getItem("ganadores")) || [];

      document
        .getElementById("archivo")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function (e) {
            lista = e.target.result
              .split("\n")
              .map((x) => x.trim())
              .filter((x) => x.length > 0);
            lista = lista.filter((item) => !ganadores.includes(item));
            alert(
              "Archivo cargado correctamente. Total participantes: " +
                lista.length
            );
          };
          reader.readAsText(file);
        });

      function sortear() {
        const cantidad = parseInt(document.getElementById("cantidad").value);
        const btn = document.getElementById("botonSortear");
        const countdownDiv = document.getElementById("cuenta-regresiva");

        if (isNaN(cantidad) || cantidad <= 0) {
          alert("Por favor, ingresa una cantidad vÃ¡lida.");
          return;
        }

        if (lista.length < cantidad) {
          alert("No hay suficientes participantes disponibles.");
          return;
        }

        let segundos = 5;
        countdownDiv.textContent = segundos;
        btn.disabled = true;

        const interval = setInterval(() => {
          segundos--;
          countdownDiv.textContent = segundos > 0 ? segundos : "";

          if (segundos === 0) {
            clearInterval(interval);
            ejecutarSorteo(cantidad);
            btn.disabled = false;
          }
        }, 1000);
      }

      function ejecutarSorteo(cantidad) {
        let nuevosGanadores = [];

        for (let i = 0; i < cantidad; i++) {
          const indice = Math.floor(Math.random() * lista.length);
          const ganador = lista.splice(indice, 1)[0];
          nuevosGanadores.push(ganador);
          ganadores.push(ganador);
        }

        localStorage.setItem("ganadores", JSON.stringify(ganadores));

        mostrarGanadores(nuevosGanadores);
        actualizarContador();
      }

      function mostrarGanadores(listaGanadores) {
        const div = document.getElementById("ganadores");
        div.innerHTML =
          "<h3>Ganadores sorteados:</h3><ul>" +
          listaGanadores.map((g) => `<li>${g}</li>`).join("") +
          "</ul>";

        // AquÃ­ se agrega la clase segÃºn la cantidad total de ganadores
        const ul = div.querySelector("ul");
        if (ganadores.length > 10) {
          ul.classList.add("dos-columnas");
        } else {
          ul.classList.remove("dos-columnas");
        }
      }
      function actualizarContador() {
        document.getElementById(
          "contador"
        ).textContent = `Ganadores hasta ahora: ${ganadores.length}`;
      }

      function reiniciar() {
        if (confirm("Â¿EstÃ¡s seguro de reiniciar los ganadores?")) {
          localStorage.removeItem("ganadores");
          ganadores = [];
          actualizarContador();
          alert("Ganadores reiniciados.");
        }
      }

      actualizarContador();
    </script>
  </body>
</html>
